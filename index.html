<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OmniExtract Pro | Stealth Edition</title>
    <!-- Tailwind CSS for high-end styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tesseract.js for client-side OCR -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-deep: #020617;
            --accent: #6366f1;
            --accent-glow: rgba(99, 102, 241, 0.4);
            --glass: rgba(15, 23, 42, 0.7);
        }

        body { 
            background-color: var(--bg-deep); 
            color: #f8fafc; 
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        .mono { font-family: 'JetBrains Mono', monospace; }

        .glass { 
            background: var(--glass); 
            backdrop-filter: blur(16px); 
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
        }

        .glow-text { text-shadow: 0 0 15px var(--accent-glow); }
        
        .scanline {
            width: 100%;
            height: 2px;
            background: var(--accent);
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0.6;
            box-shadow: 0 0 15px var(--accent);
            animation: scan 2.5s ease-in-out infinite;
            display: none;
            z-index: 5;
        }

        @keyframes scan {
            0% { top: 0; }
            50% { top: 100%; }
            100% { top: 0; }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        .gradient-border {
            position: relative;
            background: var(--bg-deep);
            border-radius: 1.5rem;
        }
        .gradient-border::before {
            content: "";
            position: absolute;
            inset: -1.5px;
            border-radius: 1.5rem;
            padding: 1.5px;
            background: linear-gradient(45deg, #1e293b, var(--accent), #4f46e5, #1e293b);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            pointer-events: none;
        }

        .btn-active {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            box-shadow: 0 0 20px rgba(79, 70, 229, 0.4);
        }

        .pulse-soft {
            animation: pulse-soft 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse-soft {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
<script type="importmap">
{
  "imports": {
    "react/": "https://esm.sh/react@^19.2.3/",
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "@google/genai": "https://esm.sh/@google/genai@^1.37.0",
    "lucide-react": "https://esm.sh/lucide-react@^0.562.0"
  }
}
</script>
</head>
<body class="min-h-screen flex items-center justify-center p-4 sm:p-8">

    <!-- Ambient Background Elements -->
    <div class="fixed inset-0 pointer-events-none overflow-hidden">
        <div class="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-indigo-900/10 rounded-full blur-[120px]"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] bg-purple-900/10 rounded-full blur-[120px]"></div>
    </div>

    <div class="w-full max-w-5xl space-y-6 relative z-10">
        
        <!-- Header -->
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-end pb-6 border-b border-slate-800 gap-4">
            <div>
                <h1 class="text-3xl font-black text-white tracking-tighter glow-text italic flex items-center gap-3">
                    OMNI<span class="text-indigo-500">EXTRACT</span> <span class="text-slate-500 not-italic font-light">PRO</span>
                </h1>
                <p class="text-[10px] text-slate-500 font-bold uppercase tracking-[0.4em] mono mt-1">Stealth Ops // Fixed CSV Format for Google Contacts</p>
            </div>
            <div class="flex items-center gap-3">
                <div id="engineStatus" class="flex items-center gap-2 text-[10px] font-bold text-slate-500 mono bg-slate-900/50 px-3 py-1.5 rounded-full border border-slate-800">
                    <span class="w-1.5 h-1.5 bg-slate-600 rounded-full" id="statusDot"></span>
                    CORE_IDLE
                </div>
                <button onclick="resetApp()" class="text-[10px] text-red-500 hover:text-red-400 font-bold uppercase tracking-widest border border-red-900/30 bg-red-950/20 px-4 py-1.5 rounded-full transition-all hover:bg-red-900/40">
                    Clear Buffer
                </button>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <!-- Left Panel: Ingestion -->
            <div class="lg:col-span-5 space-y-6">
                
                <!-- Upload Cluster -->
                <div class="gradient-border group overflow-hidden">
                    <div class="glass p-8 flex flex-col items-center justify-center text-center cursor-pointer relative min-h-[180px]">
                        <input type="file" id="fileInput" multiple accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-20">
                        <div id="scanline" class="scanline"></div>
                        <div class="p-4 bg-indigo-500/10 rounded-2xl mb-3 group-hover:scale-110 transition-transform duration-500 border border-indigo-500/20 group-hover:bg-indigo-500/20">
                            <svg class="w-8 h-8 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                        </div>
                        <p class="font-black text-white text-xl tracking-tight">INJECT BATCH</p>
                        <p class="text-[10px] text-slate-500 mono mt-2 uppercase tracking-widest font-bold">Max 20 Image Objects</p>
                    </div>
                </div>

                <!-- Progress Tracker -->
                <div id="statusPanel" class="glass p-6 rounded-2xl hidden animate-in fade-in slide-in-from-top-2 duration-300">
                    <div class="flex justify-between items-center text-[10px] font-bold mono mb-3 tracking-widest">
                        <span class="text-indigo-400 uppercase" id="progressLabel">Initializing Engine...</span>
                        <span id="percentText" class="text-white">0%</span>
                    </div>
                    <div class="h-1.5 bg-slate-900 rounded-full overflow-hidden border border-slate-800">
                        <div id="progressBar" class="h-full bg-gradient-to-r from-indigo-600 via-purple-600 to-indigo-500 w-0 transition-all duration-300"></div>
                    </div>
                </div>

                <!-- Metrics Dashboard -->
                <div class="glass p-8 rounded-3xl relative overflow-hidden border border-slate-800 shadow-2xl">
                    <div class="flex items-center justify-between mb-8">
                        <div>
                            <p class="text-[10px] font-bold text-slate-500 mono uppercase tracking-widest">Targets Identified</p>
                            <h3 class="text-6xl font-black text-white mt-1 tracking-tighter" id="countBadge">00</h3>
                        </div>
                        <div class="p-4 bg-emerald-500/5 border border-emerald-500/20 rounded-2xl">
                            <svg class="w-8 h-8 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        </div>
                    </div>
                    
                    <button id="dlBtn" onclick="downloadCSV()" disabled class="w-full py-5 bg-slate-900 text-slate-700 rounded-2xl font-black text-xs uppercase tracking-[0.2em] transition-all border border-slate-800 flex items-center justify-center gap-3">
                        <span id="btnText">System Standby</span>
                    </button>
                    <p id="nextFileHint" class="text-[9px] text-center text-slate-600 font-bold mono mt-4 uppercase tracking-widest opacity-50">Volume: 1.CSV</p>
                </div>

                <!-- Privacy Shield Notice -->
                <div class="bg-slate-900/30 rounded-2xl p-6 border border-slate-800/50">
                    <div class="flex items-start gap-3">
                        <svg class="w-5 h-5 text-indigo-500 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        <div>
                            <h4 class="text-[11px] font-black text-slate-400 uppercase tracking-widest">Privacy Protocol</h4>
                            <p class="text-[11px] text-slate-500 mt-2 leading-relaxed font-medium">
                                Extraction happens entirely on-device. Previews are obfuscated. Data is formatted for direct Google Contacts import.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Terminal Logs -->
            <div class="lg:col-span-7 glass rounded-3xl overflow-hidden flex flex-col h-[500px] lg:h-auto border border-slate-800 shadow-2xl relative">
                <div class="bg-slate-950 p-4 border-b border-slate-800 flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <div class="flex gap-1.5">
                            <div class="w-2 h-2 rounded-full bg-slate-800"></div>
                            <div class="w-2 h-2 rounded-full bg-slate-800"></div>
                            <div class="w-2 h-2 rounded-full bg-slate-800"></div>
                        </div>
                        <span class="text-[9px] font-bold text-slate-500 font-mono tracking-widest uppercase">Kernel Output Stream</span>
                    </div>
                    <span id="uptime" class="text-[9px] font-bold text-slate-700 font-mono tracking-widest uppercase">Secure Session</span>
                </div>
                <div id="consoleLog" class="flex-1 p-6 font-mono text-[11px] text-emerald-500/70 overflow-y-auto space-y-2 bg-black/40 scrollbar-hide selection:bg-indigo-500/20">
                    <p class="text-slate-600 font-bold tracking-tight">>> SYSLOG v4.2.0 INITIALIZED</p>
                    <p class="text-slate-600 font-bold tracking-tight">>> READY FOR INGESTION BUFFER...</p>
                </div>
                <!-- Ambient Log Decorative Element -->
                <div class="absolute bottom-4 right-6 opacity-10 pointer-events-none">
                    <svg class="w-32 h-32 text-slate-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M2 5a2 2 0 012-2h12a2 2 0 012 2v10a2 2 0 01-2 2H4a2 2 0 01-2-2V5zm3 1h10v1H5V6zm0 2h10v1H5V8zm0 2h10v1H5v-1zm0 2h10v1H5v-1z" clip-rule="evenodd"></path></svg>
                </div>
            </div>
        </div>
    </div>

    <!-- Processing Canvas (Hidden) -->
    <canvas id="procCanvas" class="hidden"></canvas>

    <script>
        // App State Management
        let extractedSet = new Set();
        let dlIndex = parseInt(localStorage.getItem('omniextract_dlIndex') || '1');
        let isProcessing = false;
        let worker = null;

        const ui = {
            input: document.getElementById('fileInput'),
            statusPanel: document.getElementById('statusPanel'),
            progressBar: document.getElementById('progressBar'),
            percentText: document.getElementById('percentText'),
            engineStatus: document.getElementById('engineStatus'),
            statusDot: document.getElementById('statusDot'),
            dlBtn: document.getElementById('dlBtn'),
            countBadge: document.getElementById('countBadge'),
            logs: document.getElementById('consoleLog'),
            hint: document.getElementById('nextFileHint'),
            scanline: document.getElementById('scanline'),
            progressLabel: document.getElementById('progressLabel'),
            btnText: document.getElementById('btnText')
        };

        // Initialize UI
        ui.hint.innerText = `VOLUME: ${dlIndex}.CSV`;

        // Handle File Ingestion
        ui.input.addEventListener('change', async (e) => {
            if (isProcessing) return;
            const files = Array.from(e.target.files).slice(0, 20);
            if (!files.length) return;

            initProcess(files.length);
            
            try {
                // Initialize Worker if not exists
                if (!worker) {
                    addLog(">> LOADING OCR KERNEL...", "text-indigo-400");
                    worker = await Tesseract.createWorker('eng');
                }

                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    addLog(`>> ANALYZING OBJECT: ${file.name.toUpperCase()}`, "text-slate-400 italic");
                    
                    updateProgress(((i) / files.length) * 100);
                    ui.progressLabel.innerText = `Processing: ${file.name.substring(0, 15)}...`;
                    
                    const cleanImg = await preprocessImage(file);
                    const { data: { text } } = await worker.recognize(cleanImg);
                    
                    const foundCount = parseNumbers(text);
                    
                    if (foundCount > 0) {
                        addLog(`>> SUCCESS: IDENTIFIED ${foundCount} TARGET(S).`, "text-emerald-500 font-bold");
                    } else {
                        addLog(`>> NO TARGETS DETECTED IN OBJECT ${i+1}.`, "text-slate-700");
                    }
                }
            } catch (err) {
                addLog(`>> CRITICAL ERROR: ${err.message.toUpperCase()}`, "text-red-500 font-bold");
                console.error(err);
            }

            finalizeProcess();
        });

        // Image Preprocessing Engine
        function preprocessImage(file) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.getElementById('procCanvas');
                    const ctx = canvas.getContext('2d');
                    
                    // High-contrast B&W optimization for OCR accuracy
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.filter = "grayscale(100%) contrast(160%) brightness(110%)";
                    ctx.drawImage(img, 0, 0);
                    
                    resolve(canvas.toDataURL('image/jpeg', 0.9));
                };
                img.onerror = reject;
                img.src = URL.createObjectURL(file);
            });
        }

        // Target Identification & Formatting (Indian Numbers Only)
        function parseNumbers(text) {
            const startSize = extractedSet.size;
            
            // Matches 10 digits starting with 6-9, optionally prefixed by 91, +91, 0, etc.
            const regex = /(?:(?:\+|0{0,2})91[\s-]?)?([6789][\s-]?\d[\s-]?\d[\s-]?\d[\s-]?\d[\s-]?\d[\s-]?\d[\s-]?\d[\s-]?\d[\s-]?\d)/g;
            const matches = Array.from(text.matchAll(regex));

            matches.forEach(match => {
                const clean = match[1].replace(/\D/g, ''); // Get just the 10 digits
                if (clean.length === 10) {
                    extractedSet.add(`91${clean}`); // Enforce 91 prefix
                }
            });

            ui.countBadge.innerText = extractedSet.size.toString().padStart(2, '0');
            return extractedSet.size - startSize;
        }

        // CSV Export Engine (Google Contacts Format)
        function downloadCSV() {
            if (extractedSet.size === 0) return;
            
            // Format: Name, Phone 1 - Value
            let csv = "Name,Phone 1 - Value\n";
            let i = 1;
            extractedSet.forEach(num => {
                csv += `Contact ${i},${num}\n`;
                i++;
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${dlIndex}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);

            addLog(`>> ARCHIVE EXPORTED: ${dlIndex}.CSV`, "text-indigo-400 font-bold");
            
            dlIndex++;
            localStorage.setItem('omniextract_dlIndex', dlIndex);
            ui.hint.innerText = `VOLUME: ${dlIndex}.CSV`;
        }

        // State Transition Handlers
        function initProcess(count) {
            isProcessing = true;
            ui.statusPanel.classList.remove('hidden');
            ui.scanline.style.display = 'block';
            ui.engineStatus.innerHTML = '<span class="w-1.5 h-1.5 bg-indigo-500 rounded-full animate-pulse"></span> ENGINE_ACTIVE';
            ui.engineStatus.classList.replace('text-slate-500', 'text-indigo-400');
            ui.statusDot.classList.replace('bg-slate-600', 'bg-indigo-500');
            
            ui.dlBtn.disabled = true;
            ui.dlBtn.classList.remove('btn-active');
            ui.dlBtn.classList.add('pulse-soft');
            ui.btnText.innerText = "SCANNING BUFFER...";
            
            addLog(`>> ENGAGING BATCH SCAN: ${count} OBJECTS IN QUEUE.`, "text-white font-bold");
        }

        function finalizeProcess() {
            isProcessing = false;
            updateProgress(100);
            ui.scanline.style.display = 'none';
            ui.progressLabel.innerText = 'Scan Sequence Finalized.';
            ui.engineStatus.innerHTML = '<span class="w-1.5 h-1.5 bg-emerald-500 rounded-full"></span> ENGINE_IDLE';
            ui.engineStatus.classList.replace('text-indigo-400', 'text-emerald-500');
            ui.statusDot.classList.replace('bg-indigo-500', 'bg-emerald-500');
            ui.dlBtn.classList.remove('pulse-soft');
            
            if (extractedSet.size > 0) {
                ui.dlBtn.disabled = false;
                ui.dlBtn.classList.add('btn-active');
                ui.btnText.innerText = "DOWNLOAD CSV";
                ui.dlBtn.classList.replace('text-slate-700', 'text-white');
                addLog(">> BATCH FINALIZED. IDENTITIES BUFFERED.", "text-emerald-400 font-bold");
            } else {
                ui.btnText.innerText = "No Targets Found";
                addLog(">> SCAN COMPLETE. ZERO TARGETS IDENTIFIED.", "text-amber-500 font-bold");
            }
        }

        function updateProgress(val) {
            ui.progressBar.style.width = `${val}%`;
            ui.percentText.innerText = `${Math.round(val)}%`;
        }

        function addLog(msg, classes = "") {
            const p = document.createElement('p');
            p.className = `${classes} animate-in fade-in slide-in-from-left-2 duration-300`;
            p.innerText = msg;
            ui.logs.appendChild(p);
            ui.logs.scrollTop = ui.logs.scrollHeight;
        }

        function resetApp() {
            if(confirm("Confirm system wipe? All buffered identities will be lost.")) {
                localStorage.removeItem('omniextract_dlIndex');
                location.reload();
            }
        }
    </script>
</body>
</html>